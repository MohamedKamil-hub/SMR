Servicios en red Unidad 3: Servicios de correo electrónico 
Aunque el correo electrónico parece un proceso simple 4 escribir, enviar y recibir mensajes4, detrás de cada clic en "Enviar" hay una arquitectura técnica sofisticada que garantiza que los mensajes viajen de manera segura, ordenada y confiable entre servidores distribuidos por todo el mundo. Sesión 7 4 Arquitectura del correo: MTA, MDA, MUA. Protocolos SMTP, POP, IMAP. Instalación básica de servidores de correo Cómo funciona realmente el correo electrónico Aunque el correo electrónico parece un proceso simple 4escribir, enviar y recibir mensajes4, detrás de cada clic en "Enviar" hay una arquitectura técnica sofisticada que garantiza que los mensajes viajen de manera segura, ordenada y confiable entre servidores distribuidos por todo el mundo. Comprender esa arquitectura es esencial para cualquier profesional que trabaje con sistemas de comunicación digital, ya que permite diagnosticar fallos, configurar servicios propios o integrar aplicaciones que usen correo automatizado. Los tres grandes actores del correo El flujo del correo electrónico se sostiene sobre tres componentes principales: MUA (Mail User Agent) Es el cliente de correo, la interfaz con la que tú interactúas. Ejemplos: Thunderbird, Outlook, Apple Mail, o clientes web como Roundcube o Gmail Web. El MUA permite redactar, enviar y leer mensajes, pero no entrega directamente los correos; los envía a través de un servidor. MTA (Mail Transfer Agent) Es el "cartero digital" del sistema. Se encarga de enviar los mensajes al servidor de destino y de reenviarlos entre servidores. Ejemplos: Postfix, Sendmail, Exim, Qmail. Cada MTA mantiene una cola de mensajes pendiente de envío, gestiona reintentos si el servidor remoto no responde y aplica políticas de seguridad (como filtros antispam o autenticación). MDA (Mail Delivery Agent) Es el componente que entrega finalmente el mensaje al buzón del usuario. Ejemplos: Dovecot, Procmail, Maildrop. El MDA coloca cada correo en el buzón correspondiente (ya sea un archivo mbox o un directorio Maildir) y gestiona la lectura mediante protocolos de acceso. Estos tres componentes actúan de forma secuencial: el MUA envía ³ el MTA transporta ³ el MDA entrega. 1 Los protocolos que hacen posible el correo El funcionamiento del correo electrónico se apoya en tres protocolos principales, estandarizados por la IETF y utilizados en todo el mundo: SMTP (Simple Mail Transfer Protocol) Se usa exclusivamente para enviar correos. Opera tradicionalmente en el puerto 25, aunque para conexiones seguras y autenticadas se utilizan 465 (SSL) y 587 (STARTTLS). Cada vez que un correo sale de un cliente o de un servidor intermedio, viaja mediante SMTP. POP3 (Post Office Protocol versión 3) Permite descargar los mensajes desde el servidor al cliente. Usa el puerto 110 en texto plano o 995 con TLS. Su característica principal es que los mensajes se descargan y, por defecto, se eliminan del servidor (aunque esto se puede cambiar). Es ideal cuando se accede al correo desde un solo dispositivo. IMAP (Internet Message Access Protocol) Diseñado para sincronizar correos en múltiples dispositivos. Opera en el puerto 143 (sin cifrar) o 993 (IMAPS). Permite mantener los mensajes almacenados en el servidor, marcarlos como leídos, moverlos entre carpetas, etc. Es el estándar en entornos profesionales y corporativos, ya que facilita el acceso desde webmail, móvil y escritorio simultáneamente. En resumen: SMTP = Envío, POP3 = Descarga, IMAP = Sincronización. Esquema funcional del flujo de correo El usuario redacta un mensaje en su MUA (Thunderbird, Roundcube&).1. El cliente se conecta al MTA mediante SMTP para enviarlo.2. El MTA examina el dominio del destinatario y lo reenvía al MTA del servidor remoto.3. El servidor receptor utiliza el MDA para entregar el mensaje en el buzón del usuario.4. El receptor abre su MUA y recupera el mensaje mediante POP3 o IMAP.5. Así, cada correo que viaja de un remitente a un destinatario atraviesa esta "cadena logística digital", pasando de una máquina a otra hasta llegar a destino. 2 

Esquema Visual: Arquitectura del Correo Electrónico El siguiente diagrama conceptual representa el flujo completo del correo electrónico, desde el envío hasta la recepción. Puedes reproducirlo fácilmente en formato Mermaid. Explicación del esquema: A (MUA) representa al cliente del usuario que redacta y envía mensajes. B y C (MTA) simbolizan los servidores que transportan el mensaje entre dominios, aplicando las reglas SMTP. D (MDA) es el agente que entrega el correo 



Herramientas y Consejos para tu Futuro Profesional Gestionar un sistema de correo electrónico, incluso a pequeña escala, exige combinar conocimientos técnicos con buenas prácticas de seguridad y mantenimiento. A continuación, tienes un conjunto de herramientas y consejos clave: Herramientas recomendadas Postfix ³ MTA por defecto en la mayoría de distribuciones Linux. Configurable mediante /etc/postfix/main.cf, donde se definen dominios, puertos y seguridad TLS. Dovecot ³ MDA y servidor IMAP/POP3. Su configuración básica se encuentra en /etc/dovecot/conf.d/. Roundcube ³ Cliente web (MUA) basado en PHP, ideal para entornos educativos o PYMEs. MXToolbox.com ³ Analiza registros DNS y comprueba la salud del servidor de correo. mailutils / telnet / swaks ³ Herramientas de prueba para verificar la entrega de mensajes. Certbot (Let's Encrypt) ³ Genera y renueva certificados TLS de forma automática. Consejos prácticos Configura correctamente los registros MX en el DNS de tu dominio para que otros servidores sepan dónde entregar el correo. Habilita TLS (STARTTLS o SSL) tanto en SMTP como en POP3/IMAP para proteger las credenciales de los usuarios. Revisa los logs de correo regularmente: /var/log/mail.log o /var/log/maillog muestran el recorrido de cada mensaje. Controla la cola de correo con: mailq # Lista los mensajes pendientes postqueue -f # Fuerza su envío Evita usar el puerto 25 para envío directo desde clientes; usa el 587 (SMTP autenticado), que ofrece mayor seguridad y compatibilidad. Monitorea el rendimiento con herramientas como Munin o Grafana si gestionas un entorno con alto volumen de correos. Estos hábitos son esenciales para mantener un servicio estable y evitar incidencias comunes como correos rebotados o bloqueos por listas negras. 

Mitos y Realidades o Mito 1: "SMTP sirve para recibir correos." FALSO. SMTP se utiliza exclusivamente para el envío y reenvío de correos entre servidores o desde el cliente al servidor. Para la recepción se utilizan los protocolos POP3 o IMAP, gestionados normalmente por el MDA (como Dovecot). o Mito 2: "POP3 y IMAP hacen lo mismo." FALSO. Aunque ambos se emplean para recibir mensajes, su comportamiento es diferente: POP3 descarga los mensajes al dispositivo, lo que impide sincronizar varios equipos. IMAP, en cambio, mantiene los correos en el servidor y sincroniza en tiempo real las carpetas entre distintos dispositivos. Por eso, IMAP es el protocolo más utilizado en entornos profesionales y en clientes móviles.

Resumen Final para el Examen 1 Componentes principales: MUA ³ Cliente del usuario (Thunderbird, Outlook). MTA ³ Servidor que envía mensajes (Postfix, Sendmail). MDA ³ Entrega los correos en el buzón (Dovecot, Procmail). 2 Protocolos esenciales: SMTP: Envío (puertos 25, 465, 587). POP3: Descarga (puertos 110, 995). IMAP: Sincronización (puertos 143, 993). 3 Herramientas clave: Postfix + Dovecot ³ combinación estándar en servidores Linux. Roundcube / Thunderbird ³ clientes más comunes. MXToolbox / mailq / postqueue ³ verificación y diagnóstico. 4 Buenas prácticas: Habilitar TLS para cifrar las comunicaciones. Configurar registros MX correctos. Revisar logs y colas de correo periódicamente. Idea central: SMTP envía, POP descarga, IMAP sincroniza. Postfix envía, Dovecot entrega. 7 Sesión 8 4 Gestión de usuarios, alias y buzones. Configuración de recepción y reenvío de correo. Logs y monitorización Administración práctica del correo en servidores Una vez que un servidor de correo está instalado y operativo 4normalmente con Postfix como MTA y Dovecot como MDA4, el siguiente paso esencial es gestionar correctamente los usuarios, los alias y los buzones, asegurando que cada mensaje se entregue al destinatario adecuado y quede almacenado de forma segura. Esta gestión es el corazón del mantenimiento diario de cualquier sistema de correo electrónico, ya sea en una empresa pequeña o en una gran organización con cientos de cuentas. Usuarios de correo Los usuarios representan las identidades que pueden enviar y recibir mensajes. En un servidor Linux, pueden existir de dos tipos: Usuarios locales del sistema: Son cuentas reales creadas en el sistema operativo (por ejemplo, useradd juan). Cada usuario tiene un directorio propio (/home/juan) y un buzón donde se almacenan sus correos. Este enfoque es ideal para entornos pequeños o servidores internos. Usuarios virtuales: No tienen cuenta de sistema, sino que sus datos se almacenan en una base de datos o archivo de configuración (por ejemplo, usuarios de varios dominios alojados en un mismo servidor). Esto permite escalar el servicio para gestionar múltiples dominios, como @empresa1.com, @empresa2.com, etc. Alias de correo Un alias es una dirección alternativa que redirige mensajes hacia otra cuenta o varias a la vez. Por ejemplo, el correo info@empresa.com puede enviarse automáticamente a maria@empresa.com y soporte@empresa.com sin necesidad de crear una cuenta nueva. Los alias se configuran en el archivo /etc/aliases y se actualizan con el comando newaliases. Este mecanismo permite crear direcciones genéricas (como ventas@, contacto@, rrhh@) sin sobrecargar el sistema de usuarios. 8 Ejemplo de alias: info: juan, ana soporte: admin Después de modificar el archivo: sudo newaliases Esto genera la base de datos que Postfix usa para reenviar los mensajes. Buzones de correo: dónde se guardan los mensajes Cada usuario necesita un buzón (mailbox), el espacio donde el MDA entrega los mensajes recibidos. Existen dos formatos principales: mbox Todos los mensajes del usuario se almacenan en un único archivo (por ejemplo, /var/mail/juan). Ventaja: simple y compatible con sistemas antiguos. Desventaja: difícil de manejar cuando el volumen de mensajes crece, propenso a corrupciones. Maildir Cada mensaje se guarda como un archivo independiente dentro de una carpeta. Ventaja: más seguro, rápido y compatible con IMAP. Desventaja: ocupa más espacio, pero ofrece un rendimiento superior. En servidores modernos, Maildir es el formato recomendado por su estabilidad y facilidad de backup. Recepción y reenvío Cuando un mensaje llega al servidor mediante SMTP (Postfix), el sistema debe decidir qué hacer con él: Si el dominio y el usuario existen, el MDA (Dovecot o Procmail) lo entrega al buzón correspondiente. Si el correo está dirigido a un alias, se reenvía automáticamente a los destinatarios definidos. También puede reenviarse manualmente creando un archivo .forward en el directorio del usuario, indicando allí la dirección destino. 9 Ejemplo: /home/juan/.forward ana@example.com Esto reenvía todos los mensajes de Juan a Ana sin duplicar buzones. Logs y monitorización El correo electrónico es un servicio silencioso: la mayoría de los errores no se muestran al usuario final. Por eso, supervisar los registros (logs) es una tarea crítica. Los principales archivos a revisar son: /var/log/mail.log o /var/log/maillog ³ registro general de actividad de Postfix y Dovecot. mailq o postqueue -p ³ muestra los correos pendientes en la cola. postsuper -d ALL ³ elimina mensajes atascados si hay errores recurrentes. Los logs permiten detectar errores como: Problemas de autenticación. Buzones inexistentes. Fallos de DNS o alias mal configurados. En entornos profesionales, se complementan con herramientas visuales como Logwatch, Grafana o Dovecot Logs Analyzer para visualizar métricas y patrones. 

Esquema Visual: Gestión de usuarios, alias y buzones El siguiente diagrama muestra de forma clara la arquitectura de gestión del correo en un servidor Postfix+Dovecot. Incluye el flujo de entrega, los tipos de usuarios y la interacción con los logs. Explicación del esquema A (Postfix) recibe los mensajes y decide su destino. B (Dovecot) los entrega al buzón del usuario. C (MUA) accede al correo mediante IMAP o POP. Los subgrupos muestran los mecanismos de gestión: Usuarios (locales o virtuales). Alias y reenvíos que redirigen correos. Buzones en formato mbox o Maildir. Monitorización para asegurar el correcto funcionamiento. Este esquema es la base de cualquier servidor de correo profesional. 

Herramientas y Consejos Profesionales El éxito de un sistema de correo interno no depende solo de la instalación, sino de su mantenimiento continuo y su correcta administración. Estas herramientas y buenas prácticas te ayudarán a mantener la estabilidad y fiabilidad del servicio. Herramientas clave PostfixAdmin ³ Interfaz web para gestionar usuarios y alias virtuales sin usar línea de comandos. Permite crear dominios, usuarios y contraseñas seguras fácilmente. Dovecot Logs Analyzer ³ Analiza los logs de Dovecot y genera reportes de acceso, errores y tráfico IMAP/POP. Swaks (Swiss Army Knife for SMTP) ³ Permite simular envíos SMTP para verificar la entrega. Ejemplo: swaks --to ana@techmail.local --from juan@techmail.local --server localhost Roundcube / Rainloop ³ Webmail modernos y ligeros. Facilitan el acceso multiplataforma y permiten probar configuraciones IMAP/SMTP. Grafana + Promtail + Loki ³ Solución visual para centralizar logs de correo y obtener métricas de rendimiento en tiempo real. Consejos prácticos de administración Prefiere Maildir sobre mbox: mayor fiabilidad, rendimiento y compatibilidad con IMAP. Utiliza alias para correos compartidos (como info@, ventas@, soporte@). Automatiza backups de /home/usuario/Maildir y /etc/postfix/ periódicamente. Revisa los logs cada día con: tail -f /var/log/mail.log Controla la cola de mensajes: mailq postqueue -p Limpieza periódica: Si una cola se bloquea por errores, utiliza: postsuper -d ALL Verifica la salud del servidor con MXToolbox o con pruebas telnet mail.dominio 25. Limita el tamaño máximo de los mensajes en main.cf (parámetro message_size_limit) para evitar saturación. Estas prácticas son estándar en administraciones profesionales de correo y garantizan estabilidad y seguridad a largo plazo. 14 

Mitos y Realidades o Mito 1: "Cada dirección de correo necesita un usuario independiente." FALSO. Gracias a los alias, varias direcciones pueden compartir un mismo buzón o redirigir mensajes a múltiples destinatarios. Esto simplifica la administración y reduce el consumo de recursos. o Mito 2: "Si el correo no llega, el problema siempre es del remitente." FALSO. Los fallos suelen deberse a errores locales: alias mal configurados, buzones llenos o permisos incorrectos. Por eso, revisar los logs es fundamental antes de culpar a factores externos. Usuarios: locales (sistema) o virtuales (base de datos). Alias: direcciones alternativas configuradas en /etc/aliases, actualizadas con newaliases. Buzones: formatos principales ³ mbox (1 archivo) / Maildir (1 mensaje = 1 archivo). Reenvío: mediante archivo .forward o alias de dominio. Recepción: Postfix (SMTP) recibe ³ Dovecot (IMAP/POP) entrega. Logs: /var/log/mail.log para diagnóstico; comandos mailq, postqueue, postsuper. Herramientas: PostfixAdmin, Swaks, Roundcube, Dovecot Analyzer. Buenas prácticas: revisar logs, usar TLS, automatizar backups, limpiar colas de correo. Idea central: La gestión del correo no solo es técnica: es organización, prevención y control continuo. 15 Sesión 9 4 Seguridad en correo: TLS, firma digital, cifrado, antispam y webmail Seguridad integral en el sistema de correo electrónico El correo electrónico es uno de los servicios más utilizados en el entorno digital, pero también uno de los más vulnerables. La mayoría de los ataques informáticos (phishing, spam, suplantaciones, malware) se distribuyen a través de este medio. Por ello, un servidor de correo moderno debe incorporar medidas de seguridad que garanticen la confidencialidad, la autenticidad y la integridad de la comunicación. La seguridad en el correo electrónico se apoya en cinco pilares fundamentales: Cifrado en tránsito mediante TLS El protocolo TLS (Transport Layer Security) protege las comunicaciones entre el cliente y el servidor, así como entre servidores, cifrando los datos mientras viajan por la red. TLS reemplaza al antiguo SSL y es el estándar actual en la mayoría de los servicios de correo. Los servidores suelen usar los puertos: SMTP seguro 465 o 587 (STARTTLS) IMAPS 993 POP3S 995 Esto evita que un atacante pueda leer o interceptar mensajes durante su transmisión. En Postfix y Dovecot, la configuración básica incluye la ruta al certificado y a la clave privada, generalmente almacenados en /etc/ssl/ o gestionados por Let's Encrypt. Firma digital del mensaje Una firma digital verifica la identidad del remitente y garantiza que el contenido del mensaje no ha sido alterado desde su envío. Se puede implementar mediante dos estándares principales: S/MIME (Secure/Multipurpose Internet Mail Extensions) Usa certificados digitales emitidos por autoridades certificadoras (CA). OpenPGP (GPG) Usa un sistema de claves públicas y privadas autogeneradas, más flexible y ampliamente adoptado por usuarios avanzados. Cuando un correo está firmado digitalmente, el receptor puede comprobar su autenticidad y detectar si alguien lo modificó. 16 Cifrado del contenido Mientras que TLS protege la transmisión, el cifrado de contenido protege los datos dentro del propio mensaje (texto y adjuntos). Esto significa que incluso si el correo es interceptado o el servidor es comprometido, el contenido permanece ilegible. El cifrado se realiza mediante herramientas como GPG o integraciones nativas de los clientes de correo (por ejemplo, Thunderbird o Outlook con certificados S/MIME). Antispam y antimalware El correo no deseado y el malware representan un riesgo constante. Para mitigar estos ataques, los servidores de correo incorporan filtros y motores de detección como: SpamAssassin Analiza patrones y cabeceras de los mensajes para clasificarlos como spam o legítimos. ClamAV Antivirus de código abierto que detecta adjuntos maliciosos. Amavis o Rspamd Actúan como intermediarios entre Postfix y los motores de filtrado. Estos componentes se ejecutan de forma automática y clasifican o bloquean mensajes según su nivel de riesgo. Webmail seguro El acceso a través de navegadores (por ejemplo, con Roundcube o Rainloop) introduce nuevos riesgos si no se configura adecuadamente. El servidor web que aloja el cliente debe: Ejecutar conexiones HTTPS con certificado válido. Enlazar con el servidor IMAP/SMTP solo mediante TLS. Limitar intentos de inicio de sesión y aplicar políticas de contraseñas seguras. De este modo, el acceso web al correo mantiene el mismo nivel de protección que los clientes de escritorio. 

Esquema Visual: seguridad del sistema de correo electrónico A continuación se muestra un diagrama conceptual que ilustra los componentes de seguridad dentro de un sistema de correo corporativo. Explicación del esquema: El cliente de correo se comunica con el servidor mediante TLS para evitar interceptaciones. El servidor verifica la firma digital y el origen de los mensajes. Los sistemas de filtrado antispam y antivirus analizan el contenido antes de la entrega. Los mensajes se almacenan cifrados en el buzón del usuario. El acceso web se realiza siempre mediante HTTPS, garantizando la confidencialidad extremo a extremo. Este modelo representa la estructura básica de seguridad implementada en entornos profesionales de correo electrónico. 

Herramientas y Consejos Profesionales Herramientas recomendadas Let's Encrypt + Certbot: Permite obtener y renovar automáticamente certificados TLS gratuitos. Ejemplo de instalación: sudo apt install certbot python3-certbot sudo certbot certonly --standalone -d mail.ejemplo.com SpamAssassin: Sistema de filtrado antispam basado en reglas y aprendizaje automático. Su configuración principal se encuentra en /etc/spamassassin/local.cf. ClamAV: Antivirus de código abierto para detectar y eliminar adjuntos maliciosos. Se integra fácilmente con Amavis. Amavis: Actúa como "intermediario" entre Postfix y los motores de análisis, permitiendo ejecutar múltiples filtros de seguridad en cadena. Roundcube o Rainloop: Webmail profesionales compatibles con IMAP y SMTP seguros. Deben ejecutarse siempre sobre HTTPS. Thunderbird con GPG: Cliente de correo multiplataforma que permite firmar y cifrar mensajes directamente con OpenPGP. Consejos prácticos para la administración segura Forzar TLS en todas las conexiones (entrada y salida) modificando los parámetros de seguridad en Postfix y Dovecot. No reutilizar certificados antiguos: usa Let's Encrypt para renovarlos automáticamente cada 90 días. Configurar autenticación obligatoria para el envío (SMTP AUTH). Aplicar límites de tamaño de adjuntos para evitar ataques por saturación. Implementar DKIM, SPF y DMARC para evitar la suplantación de dominio (phishing). Revisar los logs de seguridad con: tail -f /var/log/mail.log Usar fail2ban para bloquear intentos de acceso repetidos o ataques de fuerza bruta. Realizar copias de seguridad cifradas de /etc/postfix/, /etc/dovecot/ y /var/mail/. Estas prácticas son estándar en la administración moderna de sistemas de correo electrónico corporativo. 


Mitos y Realidades Mito 1: "Si un servidor usa TLS, todos los mensajes están totalmente cifrados." FALSO. TLS cifra únicamente la transmisión entre el cliente y el servidor o entre servidores, pero no protege el contenido almacenado en el buzón ni los adjuntos. Para lograr cifrado completo, es necesario utilizar S/MIME o GPG. Mito 2: "El antispam bloquea todos los correos no deseados." FALSO. Los sistemas antispam reducen drásticamente el correo basura, pero no son infalibles. Algunos mensajes legítimos pueden clasificarse erróneamente como spam (falsos positivos). Por eso es esencial revisar las carpetas de spam y ajustar las reglas de puntuación. 

Resumen Final para el Examen TLS: cifra la comunicación entre cliente y servidor, evitando la interceptación de mensajes. Firma digital (S/MIME o GPG): garantiza autenticidad y no alteración del contenido. Cifrado del contenido: protege el mensaje incluso si el servidor o la red son comprometidos. Antispam y antivirus: herramientas principales: SpamAssassin, ClamAV, Amavis. Webmail: debe funcionar únicamente con HTTPS y TLS para acceso seguro. Certificados: Let9s Encrypt permite obtenerlos y renovarlos de forma automática. Logs: /var/log/mail.log es el archivo principal para verificar la entrega y la seguridad. Buenas prácticas: habilitar autenticación SMTP, revisar logs y aplicar DKIM/SPF/DMARC. Idea central: Un sistema de correo seguro combina múltiples capas: cifrado, autenticación, filtrado y control. Ninguna medida por sí sola garantiza la protección total; la seguridad se construye a partir de la suma de todas ellas. 22